@model IEnumerable<EduTrack.Domain.Entities.Profesor>

@{
    ViewData["Title"] = "Maestros";
}

<h1>Lista de Maestros</h1>

<p>
    <a class="btn btn-primary" id="addProfesorButton">Crear Nuevo</a>
</p>

<div class="text-center">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>@Html.DisplayNameFor(model => model.Id)</th>
                <th>@Html.DisplayNameFor(model => model.Name)</th>
                <th>@Html.DisplayNameFor(model => model.Lastname)</th>
                <th>@Html.DisplayNameFor(model => model.Email)</th>
                <th>@Html.DisplayNameFor(model => model.Phone)</th>
                <th>@Html.DisplayNameFor(model => model.Gender)</th>
                <th>@Html.DisplayNameFor(model => model.Birthdate)</th>
                <th>@Html.DisplayNameFor(model => model.IsActive)</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="profesoresTableBody">
            <tr>
                <td colspan="9">Cargando datos...</td>
            </tr>
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            loadProfesores();

            // Crear nuevo registro
            $('#addProfesorButton').click(function () {
                window.location.href = '@Url.Action("Create", "Profesores")';
            });

            // Eliminar registro
            $(document).on('click', '.delete-profesor', function () {
                var profesorId = $(this).data('id');
                if (confirm('¿Estás seguro de que quieres eliminar este profesor?')) {
                    $.ajax({
                        url: '@Url.Action("Delete", "Profesores")/' + profesorId,
                        type: 'DELETE',
                        success: function () {
                            alert('Profesor eliminado exitosamente');
                            loadProfesores();
                        },
                        error: function (error) {
                            console.log('Error:', error);
                            alert('No se pudo eliminar el profesor.');
                        }
                    });
                }
            });

            // Editar registro
            $(document).on('click', '.edit-profesor', function () {
                var profesorId = $(this).data('id');
                window.location.href = '@Url.Action("Edit", "Profesores")/' + profesorId;
            });
        });

        // Función para cargar los registros
        function loadProfesores() {
            $.ajax({
                url: '@Url.Action("GetProfesores", "Profesores")', // Acción que devuelve los profesores
                type: 'GET',
                success: function (data) {
                    var tableBody = '';
                    if (data.length === 0) {
                        tableBody = '<tr><td colspan="9">No hay registros disponibles</td></tr>';
                    } else {
                        $.each(data, function (index, profesor) {
                            tableBody += `
                                <tr>
                                    <td>${profesor.id}</td>
                                    <td>${profesor.name}</td>
                                    <td>${profesor.lastname}</td>
                                    <td>${profesor.email}</td>
                                    <td>${profesor.phone}</td>
                                    <td>${profesor.gender}</td>
                                    <td>${profesor.birthdate}</td>
                                    <td>${profesor.isActive ? 'Activo' : 'Inactivo'}</td>
                                    <td>
                                        <a class="btn btn-warning edit-profesor" data-id="${profesor.id}">Editar</a>
                                        <button class="btn btn-danger delete-profesor" data-id="${profesor.id}">Eliminar</button>
                                    </td>
                                </tr>`;
                        });
                    }
                    $('#profesoresTableBody').html(tableBody);
                },
                error: function (error) {
                    console.log('Error:', error);
                    $('#profesoresTableBody').html('<tr><td colspan="9">Error al cargar los datos</td></tr>');
                }
            });
        }
    </script>
}
